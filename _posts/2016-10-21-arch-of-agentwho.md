---
layout: post
title: AgentWho 的架构简介
tags: [tech]
---

今天有用户发出了这样的疑惑，『现在 [AgentWho](https://agentwho.network) 快是因为用的人少，人多了还会像现在一样快吗？』。首先放出结论，**是的，人多了还是一样快。**至于为什么会这样，就得从我们的架构说起。

<!-- more -->

首先我们知道，一台服务器的带宽是有限的，一台服务器提供越多用户使用，速度就越慢。所以现在很多 SS 服务供应商在用户的控制面板中，可以看到服务商提供了很多线路供用户选择，类似 jp-1, jp-2, hk-1 等等，这样做当然可以缓解人多的问题——让用户自己去试哪些服务器快（或者当时用的人少），但是并是一个我们可以接受的方案。因为这样做增加了用户使用成本，没人希望使用网络的时候首先需要决定用哪一条线路。其次，很多 SS 服务提供商都只提供了直连线路，也就是用户直接连接到国外服务器，那么对于在不同地域和不同的网络条件下（比如北京联通、上海电信等），会导致一部分线路始终速度不理想，而且国际网络出口在高峰时段也拥挤不堪。

那么，AgentWho 是如何解决这个问题的呢？首先，当用户上网需要访问服务器的时候，请求了一个域名，这个时候 DNS 域名解析服务器在 N 台服务器中找到一台最适合当前用户的服务器 IP 作为返回值——这是我们的第一层负载均衡，在解析域名时就已经完成。

这台服务器是放在国内的，所以延迟跟大多数国内网站一样低（基本可以控制在 50 毫秒以下），直接顺利连上握手完成。然后，这台服务器（我们称之为前端服务器）会经过我们专门调优测试过的国际出口（绿色通道），连接到我们众多国外服务器（后端服务器）之中的一台——这样，就完成了我们的第二层负载均衡。接着接着服务器之间将会将数据加密进行通信，用户便可畅通无阻的网上冲浪了。

所以，当我们发现当前带宽和服务器数量到达一个临界点的时候，会立即启用新的前后端服务器，保证用户流畅的上网体验而不用用户反复的尝试每一个服务器或者每隔一段时间登录到后台以便添加新的节点——我们始终认为，**能花一步做到的事情，绝对不要用几步完成。**

直观的来说，即使我们只提供了一个域名供大家使用，但是理论上可以支撑无限多的用户同时流畅的使用。下面便是我们的网络架构图，可以更直观的了解上述的内容。

![arch][1]

[1]: http://zhuangsirui.img-cn-shanghai.aliyuncs.com/blog/i2p16.png
[2]: http://zhuangsirui.img-cn-shanghai.aliyuncs.com/blog/i2p16.png!thumb
